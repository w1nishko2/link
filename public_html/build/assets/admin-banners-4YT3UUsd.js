let c=null,d={},s={};function y(e={}){d={title:"",subtitle:"",link:"",hasLink:!1,buttonText:"",isActive:!0,position:1,...e},I(),x(),d.hasLink&&(document.querySelector(".banner-link-settings").style.display="block",k(!0))}function I(){document.querySelector(".banners-swiper")&&new Swiper(".banners-swiper",{slidesPerView:1,spaceBetween:0,loop:!0,autoplay:{delay:6e3,disableOnInteraction:!1},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0,dynamicBullets:!0},effect:"fade",fadeEffect:{crossFade:!0},on:{slideChange:function(){}}})}function x(){document.querySelectorAll('[contenteditable="true"]').forEach(o=>{o.addEventListener("input",L),o.addEventListener("blur",S),o.addEventListener("paste",C)});const t=document.getElementById("banner-image-input");t&&t.addEventListener("change",o=>{handleImageSelect(o,"banner-image-preview",(r,u)=>{c=r,p()})});const n=document.getElementById("banner-form");n&&n.addEventListener("submit",P);const i=document.getElementById("is-active");i&&i.addEventListener("change",function(){d.isActive=this.checked});const l=document.getElementById("position");l&&l.addEventListener("input",function(){d.position=parseInt(this.value)||1})}function L(e){const t=e.target,n=t.getAttribute("data-field");n&&d.hasOwnProperty(n)&&(d[n]=t.textContent.trim(),n==="link"&&T(t))}function S(e){const t=e.target;t.getAttribute("data-field")==="link"&&q(t)}function C(e){e.preventDefault();const t=(e.clipboardData||window.clipboardData).getData("text"),n=window.getSelection();if(!n.rangeCount)return;n.deleteFromDocument(),n.getRangeAt(0).insertNode(document.createTextNode(t)),n.collapseToEnd();const i=e.target,l=i.getAttribute("data-field");l&&d.hasOwnProperty(l)&&(d[l]=i.textContent.trim())}function T(e){const t=e.textContent.trim();t&&!w(t)?(e.classList.add("is-invalid"),showNotification("Пожалуйста, введите корректную ссылку (например: https://example.com)","warning")):e.classList.remove("is-invalid")}function q(e){let t=e.textContent.trim();t&&!t.startsWith("http://")&&!t.startsWith("https://")&&(t="https://"+t,e.textContent=t,d.link=t)}function w(e){try{return new URL(e),!0}catch{return!1}}function k(e){const t=document.getElementById("link-toggle");t&&(e?(t.innerHTML='<i class="bi bi-dash"></i> Убрать ссылку',t.className="btn btn-outline-danger btn-sm"):(t.innerHTML='<i class="bi bi-plus"></i> Добавить ссылку',t.className="btn btn-outline-success btn-sm"))}async function P(e){var i;if(e.preventDefault(),!f())return;p();const t=new FormData;Object.keys(d).forEach(l=>{d[l]!==null&&d[l]!==void 0&&t.append(l,d[l])}),c&&t.append("image",c);const n=(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content");n&&t.append("_token",n),await submitForm(e.target,{method:"POST",loadingOverlayId:"loadingOverlay",validateBeforeSubmit:f,onSuccess:l=>{l.redirect_url&&(window.location.href=l.redirect_url)}})}function p(){document.querySelectorAll('[contenteditable="true"]').forEach(l=>{const o=l.getAttribute("data-field");o&&d.hasOwnProperty(o)&&(d[o]=l.textContent.trim())});const t=document.querySelector(".banner-link-settings");d.hasLink=t&&t.style.display!=="none";const n=document.getElementById("is-active");n&&(d.isActive=n.checked);const i=document.getElementById("position");i&&(d.position=parseInt(i.value)||1)}function f(){if(p(),!d.title||d.title.trim()===""){showNotification("Пожалуйста, введите заголовок баннера","error");const e=document.querySelector('[data-field="title"]');return e&&(e.focus(),e.classList.add("is-invalid"),setTimeout(()=>e.classList.remove("is-invalid"),3e3)),!1}if(d.hasLink&&d.link&&!w(d.link)){showNotification("Пожалуйста, введите корректную ссылку","error");const e=document.querySelector('[data-field="link"]');return e&&(e.focus(),e.classList.add("is-invalid"),setTimeout(()=>e.classList.remove("is-invalid"),3e3)),!1}if(d.position<1||d.position>100){showNotification("Позиция должна быть от 1 до 100","error");const e=document.getElementById("position");return e&&(e.focus(),e.classList.add("is-invalid"),setTimeout(()=>e.classList.remove("is-invalid"),3e3)),!1}return!0}function b(e={}){s={title:e.title||"",description:e.description||"",linkUrl:e.linkUrl||"",linkText:e.linkText||"Перейти",orderIndex:e.orderIndex||1,hasLink:e.hasLink||!1},U(),A(),F()}function U(){const e=document.querySelector("#edit-banners-swiper");e&&new Swiper(e,{slidesPerView:1,spaceBetween:20,centeredSlides:!0,autoHeight:!1,height:350,direction:"horizontal",allowTouchMove:!1})}function A(){const e=document.querySelector(".editable-title"),t=document.querySelector(".editable-description");e&&(e.addEventListener("input",function(){let o=this.textContent.trim();o.length>100&&(o=o.substring(0,100),this.textContent=o),s.title=o,a()}),e.addEventListener("blur",function(){this.textContent.trim()||(this.textContent="Название баннера",s.title="")})),t&&(t.addEventListener("input",function(){let o=this.textContent.trim();o.length>300&&(o=o.substring(0,300),this.textContent=o),s.description=o,a()}),t.addEventListener("blur",function(){this.textContent.trim()||(this.textContent="Описание баннера. Нажмите, чтобы редактировать.",s.description="")}));const n=document.getElementById("order-input");n&&n.addEventListener("input",function(){s.orderIndex=this.value,a()});const i=document.getElementById("link-url-input");i&&i.addEventListener("input",function(){s.linkUrl=this.value,a()});const l=document.getElementById("hidden-image");l&&l.addEventListener("change",function(o){if(o.target.files&&o.target.files[0]){const r=o.target.files[0];c=r;const u=new FileReader;u.onload=function(v){const g=document.getElementById("banner-no-image"),m=document.getElementById("banner-preview-image");g&&m&&(g.style.display="none",m.src=v.target.result,m.style.display="block")},u.readAsDataURL(r)}})}function F(){if(a(),s.hasLink){const e=document.getElementById("has-link-checkbox"),t=document.getElementById("link-settings"),n=document.getElementById("banner-link-display"),i=document.getElementById("add-link-card-btn");e&&(e.checked=!0),t&&(t.style.display="block"),n&&(n.style.display="block"),i&&(i.style.display="none")}}function N(){const e=document.getElementById("hidden-image");e&&e.click()}function O(e){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function D(){const e=document.getElementById("has-link-checkbox");e&&(e.checked=!0);const t=document.getElementById("advanced-settings");t&&t.style.display==="none"&&(t.style.display="block"),h(),setTimeout(()=>{const n=document.getElementById("link-url-input");n&&n.focus()},100)}function h(){const e=document.getElementById("has-link-checkbox"),t=document.getElementById("link-settings"),n=document.getElementById("banner-link-display"),i=document.getElementById("add-link-card-btn");e&&e.checked?(t&&(t.style.display="block"),n&&(n.style.display="block"),i&&(i.style.display="none"),s.hasLink=!0,s.linkText||(s.linkText="Перейти",R())):(t&&(t.style.display="none"),n&&(n.style.display="none"),i&&(i.style.display="inline-block"),s.hasLink=!1,s.linkUrl="",s.linkText=""),a()}function V(){const e=document.getElementById("link-text-select"),t=document.getElementById("banner-link-button");e&&t&&(s.linkText=e.value,t.textContent=e.value,a())}function R(){const e=document.getElementById("banner-link-button");e&&(e.textContent=s.linkText||"Перейти")}function M(){const e=document.getElementById("advanced-settings");e&&(e.style.display==="none"?e.style.display="block":e.style.display="none")}function a(){const e=document.getElementById("hidden-title"),t=document.getElementById("hidden-description"),n=document.getElementById("hidden-link-url"),i=document.getElementById("hidden-link-text"),l=document.getElementById("hidden-order-index");e&&(e.value=s.title),t&&(t.value=s.description),n&&(n.value=s.linkUrl),i&&(i.value=s.linkText),l&&(l.value=s.orderIndex)}function H(){if(!s.title||s.title==="Название баннера"){alert("Пожалуйста, введите название баннера");const t=document.querySelector(".editable-title");t&&t.focus();return}if(!s.description||s.description==="Описание баннера. Нажмите, чтобы редактировать."){alert("Пожалуйста, введите описание баннера");const t=document.querySelector(".editable-description");t&&t.focus();return}B(),a();const e=document.getElementById("banner-form");e&&e.submit()}function E(){const e=document.querySelector("#banners-preview-swiper");e&&new Swiper(e,{slidesPerView:1,spaceBetween:20,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{576:{slidesPerView:1,spaceBetween:20},768:{slidesPerView:1,spaceBetween:20},992:{slidesPerView:2,spaceBetween:20},1200:{slidesPerView:2,spaceBetween:25},1400:{slidesPerView:3,spaceBetween:25}},autoHeight:!1,centeredSlides:!1,loop:!1,grabCursor:!0,watchOverflow:!0,resistance:!0,resistanceRatio:.85})}function _(e){var n;const t=document.getElementById("deleteForm");if(t){const i=window.currentUserId||((n=document.querySelector("[data-user-id]"))==null?void 0:n.dataset.userId);t.action=`/admin/user/${i}/banners/${e}`,new bootstrap.Modal(document.getElementById("deleteModal")).show()}}function $(e){var n;const t=window.currentUserId||((n=document.querySelector("[data-user-id]"))==null?void 0:n.dataset.userId);window.location.href=`/admin/user/${t}/banners/${e}/edit`}function B(){const e=document.getElementById("loading-overlay");e&&(e.style.display="flex")}function z(){const e=document.getElementById("loading-overlay");e&&(e.style.display="none")}window.initBannerPage=y;window.initBannerEditor=b;window.initBannersIndexSwiper=E;window.validateBannerForm=f;window.updateLinkToggleButton=k;window.selectImage=N;window.selectText=O;window.addLinkInCard=D;window.toggleLinkSettings=h;window.updateLinkText=V;window.toggleAdvanced=M;window.saveBanner=H;window.deleteBanner=_;window.editBanner=$;window.showLoading=B;window.hideLoading=z;document.addEventListener("DOMContentLoaded",function(){if(document.getElementById("banner-form")&&!document.getElementById("edit-banners-swiper"))y();else if(document.getElementById("edit-banners-swiper")){const e=window.bannerData||{};b(e)}else document.getElementById("banners-preview-swiper")&&E()});
