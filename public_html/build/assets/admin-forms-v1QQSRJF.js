async function h(n,r={}){var f;const{showLoading:o=!0,loadingOverlayId:t=null,validateBeforeSubmit:e=null,onSuccess:i=null,onError:s=null,method:u="POST"}=r,c=typeof n=="string"?document.querySelector(n):n;if(!c){console.error("Form not found");return}if(!(e&&typeof e=="function"&&!e())){o&&typeof window.showLoading=="function"&&window.showLoading(t);try{const l=new FormData(c);c.querySelectorAll('[contenteditable="true"]').forEach(a=>{const w=a.getAttribute("data-name");w&&l.append(w,a.textContent.trim())});const m=await fetch(c.action,{method:u,body:l,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(f=document.querySelector('meta[name="csrf-token"]'))==null?void 0:f.getAttribute("content")}});if(m.ok){const a=await m.json();i&&typeof i=="function"?i(a):(d("Данные успешно сохранены","success"),a.redirect_url&&setTimeout(()=>{window.location.href=a.redirect_url},1e3))}else{const a=await m.json();throw new Error(a.message||"Ошибка сервера")}}catch(l){console.error("Form submission error:",l),s&&typeof s=="function"?s(l):d(l.message||"Произошла ошибка при сохранении","error")}finally{o&&typeof window.hideLoading=="function"&&window.hideLoading(t)}}}function d(n,r="info",o=5e3){const t=document.createElement("div");t.className=`alert alert-${r==="error"?"danger":r} alert-dismissible fade show position-fixed`,t.style.cssText=`
        top: 20px;
        right: 20px;
        z-index: 10000;
        min-width: 300px;
        max-width: 500px;
    `,t.innerHTML=`
        ${n}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.classList.remove("show"),setTimeout(()=>{t.remove()},150))},o)}function v(n){const r=typeof n=="string"?document.querySelector(n):n;if(!r)return!1;const o=r.querySelectorAll('[required], [data-required="true"]');let t=!0;return o.forEach(e=>{let i="";if(e.hasAttribute("contenteditable")?i=e.textContent.trim():i=e.value?e.value.trim():"",i)e.classList.remove("is-invalid");else{e.classList.add("is-invalid"),t=!1;const s=()=>{e.classList.remove("is-invalid"),e.removeEventListener("input",s),e.removeEventListener("blur",s)};e.addEventListener("input",s),e.addEventListener("blur",s)}}),t||d("Пожалуйста, заполните все обязательные поля","error"),t}function b(n,r=3e4){const o=typeof n=="string"?document.querySelector(n):n;if(!o)return;let t,e=!1;const i=()=>{e=!0,clearTimeout(t),t=setTimeout(()=>{e&&h(o,{showLoading:!1,onSuccess:()=>{e=!1,d("Автосохранение выполнено","info",2e3)}})},r)};o.addEventListener("input",i),o.addEventListener("change",i),o.querySelectorAll('[contenteditable="true"]').forEach(u=>{u.addEventListener("input",i),u.addEventListener("blur",i)})}window.submitForm=h;window.showNotification=d;window.validateRequiredFields=v;window.enableAutosave=b;
