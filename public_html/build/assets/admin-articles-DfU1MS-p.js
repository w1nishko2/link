let i={title:"",excerpt:"",content:"",isPublished:!1,readTime:1};function u(e={}){console.log("Инициализация страницы статей..."),Object.assign(i,e),g(),d(),console.log("Страница статей инициализирована")}function g(){console.log("Инициализация обработчиков событий...");const e=document.querySelector(".editable-title"),t=document.querySelector(".editable-excerpt"),n=document.querySelector(".editable-content");e&&(e.addEventListener("input",f),e.addEventListener("keydown",y),e.addEventListener("paste",l)),t&&(t.addEventListener("input",h),t.addEventListener("keydown",x),t.addEventListener("paste",l)),n&&(n.addEventListener("input",p),n.addEventListener("paste",l));const o=document.getElementById("hidden-image");o&&o.addEventListener("change",L),console.log("Обработчики событий инициализированы")}function f(e){const t=e.target.textContent.trim()||"";i.title=t,d(),a()}function h(e){const t=e.target.textContent.trim()||"";i.excerpt=t,d(),a()}function p(e){const t=e.target.innerHTML.trim()||"";i.content=t,d(),a()}function y(e){e.target.textContent.length>=150&&e.keyCode!==8&&e.keyCode!==46&&e.preventDefault()}function x(e){e.target.textContent.length>=300&&e.keyCode!==8&&e.keyCode!==46&&e.preventDefault()}function l(e){e.preventDefault();const t=(e.clipboardData||window.clipboardData).getData("text");document.execCommand("insertText",!1,t)}function E(e){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function w(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=function(t){const n=t.target.files[0];n&&r(n)},e.click()}function r(e){const t=new FileReader;t.onload=function(o){const c=document.getElementById("article-image-container");c&&(c.innerHTML=`
                <img src="${o.target.result}" alt="Изображение статьи" class="img-fluid rounded">
                <div class="image-overlay">
                    <i class="bi bi-camera-fill"></i>
                    <span>Изменить изображение</span>
                </div>
            `)},t.readAsDataURL(e);const n=document.getElementById("hidden-image");if(n){const o=new DataTransfer;o.items.add(e),n.files=o.files}}function L(e){const t=e.target.files[0];t&&r(t)}function a(){const t=i.content.replace(/<[^>]*>/g,"").split(/\s+/).filter(c=>c.length>0).length,n=Math.max(1,Math.ceil(t/200));i.readTime=n;const o=document.querySelector(".read-time");o&&(o.textContent=`${n} мин чтения`),d()}function d(){const e=document.getElementById("hidden-title"),t=document.getElementById("hidden-excerpt"),n=document.getElementById("hidden-content"),o=document.getElementById("hidden-read-time"),c=document.getElementById("hidden-is-published");e&&(e.value=i.title),t&&(t.value=i.excerpt),n&&(n.value=i.content),o&&(o.value=i.readTime),c&&(c.value=i.isPublished?"1":"0")}function v(e=!1){const t=[];return(!i.title.trim()||i.title==="Новая статья")&&t.push("Пожалуйста, введите заголовок статьи"),(!i.excerpt.trim()||i.excerpt==="Краткое описание статьи. Нажмите, чтобы редактировать.")&&t.push("Пожалуйста, введите краткое описание статьи"),(!i.content.trim()||i.content==="<p>Содержание статьи. Нажмите, чтобы начать писать...</p>")&&t.push("Пожалуйста, введите содержание статьи"),t.length>0?(alert(t.join(`
`)),!1):!0}function C(e=!1){if(console.log("Сохранение статьи...",{publish:e}),!v(e))return;s(),i.isPublished=e,d();const t=document.getElementById("article-form");t?t.submit():(m(),alert("Ошибка: форма не найдена"))}function s(){const e=document.getElementById("loading-overlay");e&&(e.style.display="flex")}function m(){const e=document.getElementById("loading-overlay");e&&(e.style.display="none")}document.addEventListener("beforeunload",function(){d()});window.initArticlePage=u;window.selectText=E;window.selectImage=w;window.saveArticle=C;window.showArticleLoading=s;window.hideArticleLoading=m;console.log("Модуль admin-articles.js загружен");
